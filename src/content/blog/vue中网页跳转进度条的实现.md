---
title: "vueä¸­ç½‘é¡µè·³è½¬è¿›åº¦æ¡çš„å®ç°ğŸ––"
date: "2020-12-24 11:55"
draft: false
tags:
- vue
---

- ç½‘é¡µè·³è½¬æ—¶æ˜¾ç¤ºè¿›åº¦æ¡ï¼Œå¯ä»¥æœ‰æ•ˆé¿å…ç”¨æˆ·çš„ç„¦èºå¿ƒç†ã€‚æ‰€ä»¥å’±ä»¬æœ‰å¿…è¦åœ¨ç½‘é¡µè·³è½¬æ—¶åŠ ä¸€ä¸ªè¿›åº¦æ¡

#### ä¸šåŠ¡åœºæ™¯

1. ç½‘é¡µè·³è½¬ï¼ˆå¯èƒ½ä¼šäº§ç”Ÿç™½å±ï¼‰ï¼Œæ˜¾ç¤ºè¿›åº¦æ¡ï¼ŒåŠ è½½æ•°æ®ï¼Œæ–°ç½‘é¡µæ¸²æŸ“å¥½ä¹‹åè¿›åº¦æ¡æ¶ˆå¤±
2. å½“å‰ç½‘é¡µæ˜¾ç¤ºè¿›åº¦æ¡ï¼ŒåŒæ—¶åŠ è½½æ¸²æŸ“æ–°é¡µé¢ï¼Œå¾…æ–°é¡µé¢æ•°æ®æ‹¿åˆ°ä¹‹åå†è·³è½¬

#### æ ¸å¿ƒåŠŸèƒ½

- vue-routerå®ˆå«å‡½æ•°
- nprogressæ’ä»¶

#### å‡†å¤‡å·¥ä½œï¼ˆcliå·²ç»å¸®æˆ‘ä»¬å®ç°äº†routerç›¸å…³çš„æ­¥éª¤ï¼‰

- å®‰è£…vue-router

```bash
npm i vue-router
```

- åœ¨é¡¹ç›®ä¸­ä½¿ç”¨vue-router

```ts
import Vue from 'vue'
import Router from 'vue-router'
Vue.use(Router)
const router = new Router()
```

- å®‰è£…nprogressæ’ä»¶

```bash
npm i nprogress -D
```

- åœ¨å…¥å£main.jsä¸­å¼•å…¥æ’ä»¶

```ts
import NProgress from 'nprogress'
import 'nprogress/nprogress.css'

Vue.prototype.NProgress = NProgress
```

é¢„å¤‡å·¥ä½œæå¥½äº†ï¼Œå¼€å§‹å®ç°æ•ˆæœã€‚let's do it

#### å®ç°ç¬¬ä¸€ç§åœºæ™¯

##### æ•´ä½“æ€è·¯

- ç½‘é¡µè·³è½¬ï¼ŒåŒæ—¶æ˜¾ç¤ºè¿›åº¦æ¡ï¼Œè·³è½¬ç»“æŸä¹‹åï¼Œè¿›åº¦æ¡è¾¾åˆ°100%å¹¶æ¶ˆå¤±

æŒ‰ç…§è¿™ä¸ªæ€è·¯çš„ï¼Œç»“åˆvue-routerçš„å¯¼èˆªå®ˆå«ï¼Œå’±ä»¬å¯ä»¥å¾ˆè½»æ¾å†™å‡ºè¿™æ ·çš„ä»£ç 

```ts
// æ³¨å†Œå…¨å±€å‰ç½®å®ˆå«
router.beforeEach((to, from, next) => {
  if (to.path !== from.path) {
    NProgress.start()
  }
  next()
})
```

ä»¥ä¸Šä»£ç æå®šäº†å½“è·¯ç”±å˜åŒ–å¼€å§‹çš„æ—¶å€™ï¼Œè¿›åº¦æ¡æ˜¾ç¤ºï¼ˆ`NProgress.start()`ï¼‰ã€‚å½“è·¯ç”±è·³è½¬ä¹‹åï¼Œæœ‰ä¸¤ä¸ªæ€è·¯ï¼š

1. åœ¨æ–°é¡µé¢çš„`created()`æˆ–`mounted()`é’©å­ä¸­è·å–æ•°æ®ï¼Œå½“æ•°æ®è·å–å®Œæ¯•æ—¶ï¼Œè¿›åº¦æ¡æ¶ˆå¤±ã€‚
2. æ³¨å†Œå…¨å±€åç½®å®ˆå«ç»“æŸè¿›åº¦æ¡

- æ€è·¯1âƒ£ï¸

```
methods: {
  getData() {
      return new Promise((resolve, reject) => {
        setTimeout(() => {
          resolve();
          console.log("æ•°æ®è·å–æˆåŠŸ");
        }, 3000);
      });
    }
},
created() {
    this.getData().then(res => {
      this.NProgress.done();
    });
}
```

- æ€è·¯2âƒ£ï¸ï¼ˆåœ¨main.jsä¸­æ·»åŠ ä»£ç ï¼‰

```
router.afterEach((to, from) => {
  NProgress.done()
})
```

æ˜¾è€Œæ˜“è§ï¼Œæ€è·¯2âƒ£ï¸çš„æ•ˆæœåªæ˜¯å‡ºç°ä¸€ä¸ªçŸ­æš‚çš„è¿›åº¦æ¡è€Œå·²ï¼Œé™¤æ­¤ä¹‹å¤–æ²¡æœ‰å…¶ä»–æ„ä¹‰äº†

---

#### å®ç°ç¬¬äºŒç§åœºæ™¯

##### æ•´ä½“æ€è·¯

è¿™ç§åœºæ™¯ä¸‹ï¼Œè·¯ç”±è·³è½¬æ—¶ï¼Œå¦‚æœæ•°æ®è¿˜æ²¡è¯·æ±‚å®Œæˆï¼Œç”¨æˆ·ä¼šåœç•™åœ¨å½“å‰é¡µé¢ï¼Œè¿›åº¦æ¡å¼€å§‹åŠ¨ç”»ï¼Œå½“æ•°æ®è¯·æ±‚å®Œæ¯•ä¹‹åï¼Œç½‘é¡µè·³è½¬ï¼Œè¿›åº¦æ¡åˆ°è¾¾100%å¹¶æ¶ˆå¤±

åŒæ ·çš„ï¼Œæˆ‘ä»¬è¦å…ˆæ³¨å†Œä¸€ä¸ªå…¨å±€çš„è·¯ç”±å‰ç½®å®ˆå«

```
router.beforeEach((to, from, next) => {
  if (to.path !== from.path) {
    NProgress.start()
  }
  next()
})
```

åœ¨å¾…è¿›å…¥çš„é¡µé¢ä¸­ï¼ŒåŠ å…¥`beforeRouteEnter()`é’©å­

```
beforeRouteEnter(to, from, next) {
 getData()
  .then(res => {
    next(vm => {
      // è¿™é‡Œå¯ä»¥ä½¿ç”¨resä¸­çš„æ•°æ®æ¥åšæ¸²æŸ“
      vm.NProgress.done();
    });
  })
  .catch(() => {
    next(false);
  });
}
```

è¿™é‡Œæœ‰ç‚¹å‘çš„åœ°æ–¹å°±æ˜¯ï¼Œ`beforeRouteEnter()`ä¸­ä¸èƒ½ä½¿ç”¨`this`æ¥è·å–ç»„ä»¶å®ä¾‹ï¼Œæ‰€ä»¥`getData()`è¿™é‡Œæ˜¯é€šè¿‡å¼•å…¥çš„æ–¹å¼

